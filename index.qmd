---
title: "DAFT Package Challenge"
subtitle: "Recreating the Scurvy DAGs with Beautiful Visualizations"
format:
  html: default
execute:
  echo: true
  eval: true
---



## The Scurvy Story: A Data Science Tragedy

Scurvy was a devastating disease that affected sailors on long voyages. The cure was discovered in 1747, but due to a misunderstanding about the cause, the cure was lost for over 150 years. The story involves three different understandings of the data generating process:

1. **1747 Understanding:** Lemons prevent scurvy (correct but incomplete!)
2. **Misguided Belief:** Acid kills bacteria that causes scurvy (wrong!)
3. **1928 Understanding:** Vitamin C prevents scurvy (the real mechanism)


### DAG 1: The 1747 Understanding (Correct but Incomplete)

**Historical Context:** In 1747, James Lind discovered that lemons prevent scurvy through a controlled experiment. However, the understanding was incomplete - they knew lemons worked but not why.


```{python}
#| label: fig-scurvy-dag
#| fig-cap: "Scurvy DAG drawn with daft"
#| fig-width: 8
#| fig-height: 4
#| echo: false
try:
    import daft
except ModuleNotFoundError as e:
    raise ModuleNotFoundError(
        "The 'daft' package is required. Install with `pip install daft` and re-run."
    ) from e

import matplotlib.pyplot as plt
from daft import PGM

# Create a compact, wide canvas (similar proportions to the example)
fig = plt.figure(figsize=(3.3, 1.3), dpi=150)

# Build a tiny PGM: width ~6, height ~2.5 units keeps things compact
pgm = daft.PGM(
    shape=[6, 3],
    origin=[0, 0],
    node_unit=1.4,     # controls node size
    grid_unit=1.6      # spacing scale (helps the oval look)
)

# Nodes (keep y centered; spread x to match the reference layout)
pgm.add_node("lemons", "Lemons", 2.0, 1.25, plot_params={"ec": "black"})
pgm.add_node("scurvy", "Scurvy", 4.2, 1.25, plot_params={"ec": "black"})

# Edge
pgm.add_edge("lemons", "scurvy")

# Render and style like the sample
pgm.render()
plt.title("Simplified Lind's Model (1747)", fontsize=9, pad=2)
plt.axis("off")
plt.tight_layout(pad=0.4)
plt.show()
```

### DAG 2: The Misguided Belief (Wrong Understanding)

**Historical Context:** Over time, people came to believe it was the acid in lemons that killed bacteria which was causing scurvy. This led to lemons being replaced by limes (cheaper but less Vitamin C) or just using acids like vinegar, causing scurvy to return.



```{python}
#| label: dag-2-misguided
#| echo: false

# Styled, DAFT-ONLY version with bigger canvas, oval-like nodes, and diagonal arrows
# (matches your styling example: aspect/scale/colors/alternate_style)

try:
    import daft
except ModuleNotFoundError as e:
    raise ModuleNotFoundError(
        "The 'daft' package is required. Install with `pip install daft` and re-run."
    ) from e

import matplotlib.pyplot as plt

# Compact figure so it fits Quarto width without horizontal scrolling
plt.figure(figsize=(6, 3), dpi=160)

pgm = daft.PGM(
    shape=[8, 4],
    origin=[0, 0],
    node_unit=1.1,
    grid_unit=1.3,
    dpi=150,
    alternate_style="outer"
)

# --- Styled nodes (same colors, slightly tighter spacing) ---
pgm.add_node(
    "acid", "Acid", 1.5, 3.2, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "lightgreen", "edgecolor": "darkgreen",
        "linewidth": 2, "alpha": 0.85
    }
)

pgm.add_node(
    "bac_in_food", "Bacteria in Food", 4.0, 2.1, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "lightyellow", "edgecolor": "goldenrod",
        "linewidth": 2, "alpha": 0.85
    }
)

pgm.add_node(
    "scurvy", "Scurvy", 6.5, 1.0, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "honeydew", "edgecolor": "seagreen",
        "linewidth": 2, "alpha": 0.85
    }
)

# --- Diagonal arrows (unchanged styling) ---
pgm.add_edge("acid", "bac_in_food", plot_params={"linewidth": 2, "alpha": 0.9})
pgm.add_edge("bac_in_food", "scurvy", plot_params={"linewidth": 2, "alpha": 0.9})

# Render
pgm.render()
plt.title("Updated Bacterial Theory (Late 19th Century)", fontsize=10, pad=4)
plt.axis("off")
plt.tight_layout(pad=0.35)
plt.show()
```

### DAG 3: The 1928 Understanding (Complete and Correct)

**Historical Context:** In 1928, the true mechanism was discovered - it was Vitamin C (ascorbic acid) that prevented scurvy. This complete understanding finally explained why lemons worked and why the acid theory was wrong.


```{python}
#| label: dag-3-1928
#| echo: false

import daft
import matplotlib.pyplot as plt

# Compact version that fits within Quarto without scrolling
plt.figure(figsize=(6, 3), dpi=160)

pgm = daft.PGM(
    shape=[8, 4],
    origin=[0, 0],
    node_unit=1.1,
    grid_unit=1.3,
    dpi=150,
    alternate_style="outer"
)

# --- Styled nodes (same colors, slightly tighter spacing) ---
pgm.add_node(
    "vitamin_c", "Vitamin C", 1.5, 3.2, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "lightgreen", "edgecolor": "darkgreen",
        "linewidth": 2, "alpha": 0.85
    }
)

pgm.add_node(
    "collagen", "Collagen Synthesis", 4.0, 2.1, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "lightyellow", "edgecolor": "goldenrod",
        "linewidth": 2, "alpha": 0.85
    }
)

pgm.add_node(
    "scurvy", "Scurvy", 6.5, 1.0, aspect=3, scale=1.1,
    plot_params={
        "facecolor": "honeydew", "edgecolor": "seagreen",
        "linewidth": 2, "alpha": 0.85
    }
)

# --- Diagonal arrows (unchanged styling) ---
pgm.add_edge("vitamin_c", "collagen", plot_params={"linewidth": 2, "alpha": 0.9})
pgm.add_edge("collagen", "scurvy", plot_params={"linewidth": 2, "alpha": 0.9})

# --- Render ---
pgm.render()
plt.title("Simplified Modern Understanding (1930s onwards)", fontsize=10, pad=4)
plt.axis("off")
plt.tight_layout(pad=0.4)
plt.show()
```

